
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Result</title>

    <style>
    
    #chart{
            width: 1200px;
            height: 1000px;
            background-color: #f7f7f7;
            margin: 25px auto;
        }

        .link {
            fill:none;
            stroke: rgb(165, 161, 161);
            stroke-width:2px;
        } 

    </style> 
</head>
<body>    

    <div id="chart"></div>
    <script src="https://d3js.org/d3.v5.min.js"></script> 
<script>
    let dados = {{ melhoresRotas }};
    let nos = [];
    let chart_width = 1200;
    let chart_height = 1000;
    let posicaoInicialX = 0;
    let posicaoInicialY = 100;
    let coordenadasDoEstado = [];
    let melhoresRotasLista = {{ melhoresRotasLista }};

    let Coordenate = function(id, x, y) {
        this.parent = parent;
        this.id = id;
        this.x = x || 0;
        this.y = y || 0;
    }


    for(let i = 0; i < Object.keys(dados).length; i++ ) {
       nos.push(Object.keys(dados)[i]);      
    }


    let svg = d3.select('#chart')
            .append('svg')
            .attr('width',chart_width)
            .attr('height', chart_height);

    let dragLine = svg
        .append("path")
        .attr("class", "dragLine hidden")
        .attr("d", "M0,0 L0,0");

    
    let groupPath = svg.append('g')
                    .attr('render-order', -1);
    
    let groupCircle = svg.append('g')
                    .attr('render-order', 1);

    groupCircle.selectAll('circle')
        .data(nos)
        .enter()
        .append('circle')
        .attr('r', 20)
        .attr('cx',function(d, i){
            if( i % 4 == 0 ) {
                posicaoInicialX = 175;
            }  else {
                posicaoInicialX += 256; 
            }
            return posicaoInicialX;
        })
        .attr('cy', function(d, i) {
            if(i % 4 == 0 && i != 0) {
                posicaoInicialY += 200;
            } else if(i == 0 ) {
                posicaoInicialY = 100;
            }

            if( i % 4 == 0 ) {
                posicaoInicialX = 175;
            }  else {
                posicaoInicialX += 256; 
            }
            Object.assign(coordenadasDoEstado, {[d]: new Coordenate(d, posicaoInicialX, posicaoInicialY)});
    
            return posicaoInicialY;
        })
        .attr('fill', '#7ED26D')
        .attr('id', function(d){
            return 'circle'+d;
        });


    let link = d3.line()
            .x(function(d) { return d.x; })
            .y(function(d) { return d.y; })
     .curve(d3.curveLinear);


    for(let i = 0; i < Object.keys(dados).length; i++) {
        let keyNo = nos[i];
        let ligacoesDiretas = dados[keyNo];
        for(let j = 0; j < dados[keyNo].length; j++){
            groupPath.append('path')
            .attr("d",function(d) {
                    if(ligacoesDiretas[j] != 0){   
                    let noCorrodenadasOrigem = coordenadasDoEstado[keyNo];
                    let noCoordenadasDestino = coordenadasDoEstado[ligacoesDiretas[j]];
                    return "M" +(noCorrodenadasOrigem.x)+"," +noCorrodenadasOrigem.y +
                    "L" +(noCoordenadasDestino.x) +","+noCoordenadasDestino.y;
                    }
            })
            .attr("class", "link");
        }
    }


    let text = svg.selectAll('text')
            .data(nos)
            .enter()
            .append('text')
            .attr('x',function(d, i){
                if( i % 4 == 0 ) {
                    posicaoInicialX = 175;
                }  
                else {
                    posicaoInicialX += 256; 
                } 
                return posicaoInicialX - 8;
            })
            .attr('y', function(d,i) {
                if(i % 4 == 0 && i != 0) {
                    posicaoInicialY += 200;
                } else if(i == 0 ) {
                    posicaoInicialY = 100;
                }
                return posicaoInicialY + 3;
            })
            .text(function(d) {
                return d;
            })
            .attr('font-family', 'sans-serif')
            .attr('font-size','15px')
            .attr('fill','white')

    
    function transform(d) {
        return "translate(" + x(d.x) + "," + y(d.y) + ")";
    }


</script>
</body>
</html>

